on 1:TEXT:*:#fuelrats,#ratchat: {
  if ($nick isin "MechaSqueak[BOT]") {
    if ($regex(signal, $1-, /RATSIGNAL - CMDR (.*) - Reported System: .* \([a-z]{2}(?:-[A-Z]{2})?\) (?:- IRC Nick (.*) )?\(Case #(\d+)\) \(\w+_SIGNAL\)/S)) {
      if ($regml(signal, 3) == $null) {
        /set %nickname $regml(signal, 1)
        /set %caseNumber $regml(signal, 2)
      }
      else {
        /set %nickname $regml(signal, 2)
        /set %caseNumber $regml(signal, 3)
      }

      /hadd -m10 cases %caseNumber %nickname
    }

    if ($regex(nickCMD, $1-, /Client nick for case #(\d+) \(.*\) has been changed to (.*)\./S)) {
      /set %nickname $regml(nickCMD, 2)
      /set %caseNumber $regml(nickCMD, 1)
      /hadd -m10 cases %caseNumber %nickname
    }

    if ($regex(nickChange, $1-, /Caution: Client of case #(\d+) \(.*\) has changed IRC nick to (.*)/S)) {
      /set %nickname $regml(nickChange, 2)
      /set %caseNumber $regml(nickChange, 1)
      /hadd -m10 cases %caseNumber %nickname
    }

    if ($regex(close, $1-, /Successfully closed case #(\d+).*/S)) {
      /set %caseNumber $regml(close, 1)
      /hdel cases %caseNumber
    }

    if ($regex(md, $1-, /Successfully added case #(\d+) \(.*\) to the trash\./S)) {
      /set %caseNumber $regml(md, 1)
      /hdel cases %caseNumber
    }
  }
}
